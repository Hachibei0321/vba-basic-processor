# VBA基本処理コード - PDF取得後のデータ整理処理

関西のおばちゃん風コメント付きのVBAコードで、PDF取得後のExcelデータを自動整理する処理です♪

## 📁 ファイル構成

| ファイル名 | 説明 | 使用推奨 |
|------------|------|----------|
| `BasicProcessor_Complete_Plus.bas` | **最新版メインファイル** | ⭐ **これを使って！** |
| `BasicProcessor_Complete.bas` | 完全版（プレート処理前） | 参考用 |
| `DiagnosticTools.bas` | 診断用ツール | 必要に応じて |
| `BasicProcessor_Final.bas` | 最終版（追加要求前） | 参考用 |
| `Step2_Fixed_Final.bas` | Step2単体修正版 | 参考用 |

## 🚀 使い方

1. **VBAエディタを開く**
   - Excel で `Alt + F11` を押す

2. **コードをコピー**
   - `BasicProcessor_Complete_Plus.bas` の内容をコピー
   - VBAエディタに新しいモジュールを作成して貼り付け

3. **実行**
   - `基本処理_完全版プラス()` を実行
   - または `F5` キーで実行

## 📋 処理内容（13ステップ）

### 【最初の処理群】
1. **Table001のB列削除**
2. **Table002の2行目削除** ← 🆕追加
3. **文字列削除**: （内作）（別注）（全ﾈｼﾞ）（非在庫品）を削除
4. **x→X変換**: 小文字を大文字に変換
5. **カタカナ半角変換**: 全角カタカナを半角に変換
6. **F10T変換**: `F10T M22X60` → `F10T-M22X60` ← 🆕追加
7. **S10T変換**: `S10T M22X60` → `S10T22X60` ← 🆕追加

### 【その後の処理群】
8. **空白行削除**: A~E列がすべて空欄の行を削除
9. **ネコアングル変換**: 連続6行のうち上から4行を変換 ← 🆕追加
   - `ﾈｺｱﾝｸﾞﾙ` → `ﾈｺｱﾝｸﾞﾙ D-10`
   - `ﾈｺｱﾝｸﾞﾙ` → `ﾈｺｱﾝｸﾞﾙ D-15`
   - `ﾈｺｱﾝｸﾞﾙ` → `ﾈｺｱﾝｸﾞﾙ D-20`
   - `ﾈｺｱﾝｸﾞﾙ` → `ﾈｺｱﾝｸﾞﾙ D-30`
10. **プレート処理**: END PL/PL-の統合処理 ← 🆕**NEW!!**
    - B列に「END PL」または「PL-」を含み、D列が数値の行を特定
    - D列の平均値を計算
    - 最上段行のD列に平均値、B列を「プレート」に変更
    - 最上段以外の該当行を削除
11. **データ統合**: Table002のデータをTable001に統合
12. **テーブル形式解除**: Table002のテーブル形式を解除
13. **シート名変更**: Table001 → "原価リスト"

## 🆕 プレート処理の詳細

### 対象条件
- **B列**: 「END PL」または「PL-」を含む文字列
- **D列**: 数値が入力されている

### 処理内容
1. **対象行を特定**: 上記条件に合致する行をすべて抽出
2. **平均値計算**: 該当行のD列の数値の平均値を計算
3. **最上段更新**: 
   - 最初に見つかった行のB列を「プレート」に変更
   - 同じ行のD列に計算した平均値を入力
4. **重複削除**: 最上段以外の該当行をすべて削除

### 実行例
```
処理前:
行5: B列="END PL TYPE-A" D列=100
行8: B列="PL-SPECIAL"   D列=150
行12: B列="END PL-B"    D列=120

処理後:
行5: B列="プレート"     D列=123.33 (平均値)
行8: 削除
行12: 削除
```

## 🔧 診断ツール

### 文字列診断（個別）
```vba
文字列診断_詳細版()
```
- 選択したセルの文字を1文字ずつ分析
- ASCIIコードとHEXコードを表示

### 範囲診断（全体）
```vba
範囲診断_削除対象文字列検索()
```
- シート全体から削除対象文字列を検索
- どこに何があるかを一覧表示

## 📊 実行結果の確認

実行後、イミディエイトウィンドウ（`Ctrl + G`）で詳細ログを確認できます：

```
=== ステップ5.6: プレート処理開始 ===
プレート対象行発見(1): 行5 B列=[END PL TYPE-A] D列=[100]
プレート対象行発見(2): 行8 B列=[PL-SPECIAL] D列=[150]
プレート対象行発見(3): 行12 B列=[END PL-B] D列=[120]
プレート対象行数: 3行
D列平均値: 123.333333333333
最上段行: 5
最上段更新完了: 行5 B列=プレート D列=123.333333333333
プレート行削除: 元の行8
プレート行削除: 元の行12
プレート行削除完了: 2行を削除
=== ステップ5.6完了 ===
```

## ⚠️ 注意事項

1. **シート名**: `Table001 (Page 1)` と `Table002 (Page 1)` が存在することを確認
2. **バックアップ**: 実行前に必ずExcelファイルのバックアップを作成
3. **全角括弧**: 実際のデータは全角括弧（）を使用（診断ツールで確認済み）
4. **プレート処理**: D列に数値以外が入っている場合は対象外となります

## 🐛 トラブルシューティング

### 文字列が削除されない場合
1. `範囲診断_削除対象文字列検索()` を実行
2. 実際の文字列形式を確認
3. 必要に応じてコードを調整

### プレート処理がうまくいかない場合
1. B列に「END PL」または「PL-」が含まれているか確認
2. D列の値が数値形式になっているか確認
3. イミディエイトウィンドウでプレート対象行の検出ログを確認

### エラーが発生する場合
1. シート名を確認
2. データの形式を確認
3. イミディエイトウィンドウでエラー内容を確認

## 🆕 バージョン履歴

### v4.0 完全版Plus (2025/06/18)
- **プレート処理追加** ← **NEW!!**
  - END PL/PL-の自動統合
  - D列平均値計算
  - 重複行削除

### v3.0 完全版 (2025/06/18)
- F10T変換処理追加
- S10T変換処理追加
- Table002の2行目削除追加
- ネコアングル変換処理追加

### v2.0 最終版 (2025/06/18)
- 全角括弧（）対応
- テーブル解除エラー修正
- 診断ツール追加

### v1.0 初期版 (2025/06/16)
- 基本的な8ステップ処理

## 👩‍💻 作成者

関西のおばちゃん 😊

初心者にもわかりやすいコメント付きで作成してます♪
何かわからんことがあったら、遠慮せんと聞いてや〜！